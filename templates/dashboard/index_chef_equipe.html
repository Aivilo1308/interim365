{% extends "index.html" %}
{% load static %}

{% block title %}Dashboard Chef d'√âquipe - {{ profil_utilisateur.nom_complet }}{% endblock %}

{% block extra_css %}
<style>
  /* Styles sp√©cifiques au niveau chef d'√©quipe */
  .team-overview {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 50%, var(--secondary) 100%);
    color: white;
    border-radius: 1rem;
    padding: 3rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .team-overview::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
      linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
    animation: shimmer 8s ease-in-out infinite;
  }

  @keyframes shimmer {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
  }

  .team-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    z-index: 1;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }

  .team-subtitle {
    font-size: 1.2rem;
    opacity: 0.95;
    margin-bottom: 2.5rem;
    position: relative;
    z-index: 1;
  }

  .team-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    position: relative;
    z-index: 1;
  }

  .team-stat {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s;
    cursor: pointer;
  }

  .team-stat:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }

  .team-stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 1.5rem;
  }

  .team-stat-value {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
    background: linear-gradient(45deg, #fff, #e2e8f0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .team-stat-label {
    font-size: 1rem;
    opacity: 0.9;
    font-weight: 600;
  }

  .team-stat-trend {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .management-center {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .management-panel {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }

  .management-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 1.5rem;
    font-size: 1.3rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .management-content {
    padding: 1.5rem;
  }

  .team-health {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .health-card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    padding: 1.5rem;
    border-left: 4px solid var(--primary);
    transition: all 0.3s;
  }

  .health-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .health-card.warning {
    border-left-color: var(--orange);
  }

  .health-card.critical {
    border-left-color: var(--danger);
  }

  .health-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .health-metrics {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .health-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
  }

  .health-card.warning .health-value {
    color: var(--orange);
  }

  .health-card.critical .health-value {
    color: var(--danger);
  }

  .health-status {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.8rem;
    font-weight: 600;
    background: var(--primary-light);
    color: var(--primary-dark);
  }

  .health-card.warning .health-status {
    background: var(--orange-light);
    color: var(--orange);
  }

  .health-card.critical .health-status {
    background: #fee2e2;
    color: var(--danger);
  }

  .team-activity {
    max-height: 400px;
    overflow-y: auto;
  }

  .activity-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--gray-200);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-weight: 600;
    flex-shrink: 0;
  }

  .activity-content {
    flex: 1;
  }

  .activity-title {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
  }

  .activity-desc {
    font-size: 0.875rem;
    color: var(--gray-600);
    margin-bottom: 0.25rem;
  }

  .activity-time {
    font-size: 0.75rem;
    color: var(--gray-500);
  }

  .team-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .team-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: white;
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius);
    text-decoration: none;
    color: var(--gray-700);
    transition: all 0.3s;
    text-align: center;
  }

  .team-action:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .team-action-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--primary);
  }

  .team-action-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .team-action-desc {
    font-size: 0.875rem;
    color: var(--gray-600);
  }

  .urgent-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--danger);
    color: white;
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: 9999px;
    font-weight: 600;
  }

  .team-analytics {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow-lg);
    margin-bottom: 2rem;
    overflow: hidden;
  }

  .analytics-header {
    background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
    color: white;
    padding: 1.5rem;
    font-size: 1.3rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .analytics-content {
    padding: 1.5rem;
  }

  .analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .analytics-chart {
    background: var(--gray-50);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s;
  }

  .analytics-chart:hover {
    background: var(--gray-100);
    transform: translateY(-2px);
  }

  .chart-title {
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 1rem;
  }

  .chart-placeholder {
    height: 200px;
    background: var(--gray-200);
    border-radius: var(--border-radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-500);
    font-style: italic;
  }

  .team-matrix {
    background: white;
    border-radius: 1rem;
    box-shadow: var(--shadow-lg);
    margin-bottom: 2rem;
  }

  .matrix-header {
    background: linear-gradient(135deg, var(--gray-800), var(--gray-700));
    color: white;
    padding: 1.5rem;
    font-size: 1.3rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .matrix-grid {
    padding: 1.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .member-matrix-card {
    border: 2px solid var(--gray-200);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    transition: all 0.3s;
    background: linear-gradient(135deg, var(--gray-50), white);
  }

  .member-matrix-card:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .member-matrix-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--gray-200);
  }

  .member-matrix-name {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--gray-800);
  }

  .member-matrix-status {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--secondary);
  }

  .member-matrix-status.warning {
    background: var(--orange);
  }

  .member-matrix-status.critical {
    background: var(--danger);
  }

  .member-matrix-metrics {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .member-matrix-metric {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
  }

  .member-matrix-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.25rem;
  }

  .member-matrix-label {
    font-size: 0.8rem;
    color: var(--gray-600);
  }

  .member-avatar-large {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-weight: 600;
    margin-right: 1rem;
  }
  
  /* Alignement horizontal des stat-card */
  .stats-row {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap; /* Permet le retour √† la ligne sur mobile */
  }

  .recent-interims {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap; /* Permet le retour √† la ligne sur mobile */
  }

  @media (max-width: 1024px) {
    .management-center {
      grid-template-columns: 1fr;
    }
    
    .team-stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .analytics-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .team-title {
      font-size: 2rem;
    }
    
    .team-stat-value {
      font-size: 2rem;
    }
    
    .team-actions {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .matrix-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block page_title %}Dashboard Chef d'√âquipe{% endblock %}

{% block page_subtitle %}
Gestion de votre √©quipe - {{ stats.membres_equipe }} membre(s) dans {{ profil_utilisateur.departement.nom|default:"votre d√©partement" }}
{% endblock %}

{% block main_content %}
<!-- Vue d'ensemble de l'√©quipe -->
<div class="team-overview">
  <h2 class="team-title">
    <i class="fas fa-users"></i>
    Mon √âquipe
  </h2>
  <p class="team-subtitle">
    Supervision directe de {{ stats.membres_equipe }} collaborateur(s) - {{ profil_utilisateur.departement.nom|default:"D√©partement non d√©fini" }}
  </p>
  
  <div class="team-stats-grid">
    <div class="team-stat">
      <div class="team-stat-icon">
        <i class="fas fa-user-friends"></i>
      </div>
      <div class="team-stat-value">{{ stats.membres_equipe }}</div>
      <div class="team-stat-label">√âquipiers</div>
      <div class="team-stat-trend">+2 ce mois</div>
    </div>
    
    <div class="team-stat">
      <div class="team-stat-icon">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <div class="team-stat-value">{{ stats.demandes_equipe_total }}</div>
      <div class="team-stat-label">Demandes √©quipe</div>
      <div class="team-stat-trend">+15% vs mois dernier</div>
    </div>
    
    <div class="team-stat">
      <div class="team-stat-icon">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="team-stat-value">{{ stats.missions_en_cours }}</div>
      <div class="team-stat-label">Missions actives</div>
      <div class="team-stat-trend">En cours</div>
    </div>
    
    <div class="team-stat">
      <div class="team-stat-icon">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="team-stat-value">{{ stats.taux_reussite_equipe|default:85 }}%</div>
      <div class="team-stat-label">Performance √©quipe</div>
      <div class="team-stat-trend">+3% vs objectif</div>
    </div>
  </div>
</div>

<!-- Statistiques niveau √©quipe -->
<div class="stats-row">
  <div class="stat-card">
    <div class="stat-icon primary">
      <i class="fas fa-user-check"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ stats.membres_equipe }}</div>
      <div class="stat-label">Membres √©quipe</div>
    </div>
  </div>
  
  <div class="stat-card" onclick="location.href='{% url 'liste_interim_validation' %}'">
    <div class="stat-icon orange">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ stats.validations_a_traiter }}</div>
      <div class="stat-label">Validations √† traiter</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon secondary">
      <i class="fas fa-handshake"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ stats.missions_en_cours }}</div>
      <div class="stat-label">Missions √©quipe</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon primary">
      <i class="fas fa-clipboard-list"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ stats.demandes_equipe_total }}</div>
      <div class="stat-label">Demandes totales</div>
    </div>
  </div>
</div>

<!-- Centre de gestion -->
<div class="management-center">
  <div class="management-panel">
    <div class="management-header">
      <i class="fas fa-clipboard-check"></i>
      Supervision √âquipe
    </div>
    <div class="management-content">
      <!-- Informations importantes pour le chef d'√©quipe -->
      {% if stats.validations_a_traiter > 0 %}
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        En tant que chef d'√©quipe, vous pouvez cr√©er des demandes et proposer des candidats. 
        Les validations sont trait√©es par votre responsable hi√©rarchique.
      </div>
      {% endif %}
      
      <!-- Actions rapides du chef d'√©quipe -->
      <div class="team-actions" style="grid-template-columns: 1fr;">
        <a href="{% url 'interim_demande' %}" class="team-action">
          <div class="team-action-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div class="team-action-title">Nouvelle demande</div>
          <div class="team-action-desc">Cr√©er une demande d'int√©rim pour votre √©quipe</div>
        </a>
        
        <a href="{% url 'employes_liste' %}" class="team-action">
          <div class="team-action-icon">
            <i class="fas fa-user-friends"></i>
          </div>
          <div class="team-action-title">G√©rer l'√©quipe</div>
          <div class="team-action-desc">Voir les profils et disponibilit√©s</div>
        </a>
        
        <a href="{% url 'interim_stats' %}" class="team-action">
          <div class="team-action-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="team-action-title">Statistiques √©quipe</div>
          <div class="team-action-desc">Performance et indicateurs</div>
        </a>
      </div>
    </div>
  </div>
  
  <div class="management-panel">
    <div class="management-header">
      <i class="fas fa-bell"></i>
      Activit√© R√©cente
    </div>
    <div class="management-content">
      <div class="team-activity">
        <div class="activity-item">
          <div class="activity-avatar">JD</div>
          <div class="activity-content">
            <div class="activity-title">Jean Dupont a soumis une demande</div>
            <div class="activity-desc">Poste: Technicien maintenance - Du 15/07 au 20/07</div>
            <div class="activity-time">Il y a 2 heures</div>
          </div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">MS</div>
          <div class="activity-content">
            <div class="activity-title">Marie Simon mission termin√©e</div>
            <div class="activity-desc">Secr√©taire administrative - Mission r√©ussie</div>
            <div class="activity-time">Il y a 1 jour</div>
          </div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">PL</div>
          <div class="activity-content">
            <div class="activity-title">Pierre Lefebvre disponible</div>
            <div class="activity-desc">Retour de cong√©s - Disponible pour missions</div>
            <div class="activity-time">Il y a 2 jours</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sant√© de l'√©quipe -->
<div class="team-health">
  <div class="health-card">
    <div class="health-title">
      <i class="fas fa-user-check"></i>
      Disponibilit√© √âquipe
    </div>
    <div class="health-metrics">
      <div class="health-value">{{ stats.membres_disponibles|default:6 }}</div>
      <div class="health-status">Optimal</div>
    </div>
  </div>
  
  <div class="health-card {% if stats.demandes_en_attente > 5 %}warning{% endif %}">
    <div class="health-title">
      <i class="fas fa-clock"></i>
      Demandes en Attente
    </div>
    <div class="health-metrics">
      <div class="health-value">{{ stats.demandes_en_attente|default:3 }}</div>
      <div class="health-status">{% if stats.demandes_en_attente > 5 %}Attention{% else %}Normal{% endif %}</div>
    </div>
  </div>
  
  <div class="health-card">
    <div class="health-title">
      <i class="fas fa-thumbs-up"></i>
      Taux de R√©ussite
    </div>
    <div class="health-metrics">
      <div class="health-value">{{ stats.taux_reussite_equipe|default:92 }}%</div>
      <div class="health-status">Excellent</div>
    </div>
  </div>
  
  <div class="health-card">
    <div class="health-title">
      <i class="fas fa-stopwatch"></i>
      D√©lai Moyen
    </div>
    <div class="health-metrics">
      <div class="health-value">1.8j</div>
      <div class="health-status">Rapide</div>
    </div>
  </div>
</div>

<!-- Tableau global des demandes √©quipe -->
<div class="recent-interims">
  <div class="section-header">
    <h3 class="section-title">
      <i class="fas fa-list"></i>
      Demandes de Mon √âquipe
    </h3>
    <div class="section-actions">
      <button class="btn btn-outline" onclick="refreshTeamData()">
        <i class="fas fa-sync-alt"></i>
        Actualiser
      </button>
      <button class="btn btn-outline" onclick="exportTeamData()">
        <i class="fas fa-file-export"></i>
        Export √âquipe
      </button>
      <a href="{% url 'historique_interim' %}" class="btn btn-primary">
        <i class="fas fa-history"></i>
        Historique √âquipe
      </a>
    </div>
  </div>
  
  {% if demandes_recentes %}
  <table>
    <thead>
      <tr>
        <th>Demandeur</th>
        <th>Poste demand√©</th>
        <th>P√©riode</th>
        <th>Statut</th>
        <th>Urgence</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for demande in demandes_recentes %}
      <tr>
        <td>
          <div class="candidate-info">
            <div class="candidate-avatar">{{ demande.demandeur.initiales }}</div>
            <div class="candidate-details">
              <div class="candidate-name">{{ demande.demandeur.nom_complet }}</div>
              <div class="candidate-position">{{ demande.demandeur.poste.titre|default:"Poste non d√©fini" }}</div>
            </div>
          </div>
        </td>
        <td>
          <div class="candidate-details">
            <div class="candidate-name">{{ demande.poste.titre }}</div>
            <div class="candidate-position">{{ demande.poste.site.nom|default:"Site non d√©fini" }}</div>
          </div>
        </td>
        <td>
          <div class="candidate-details">
            <div class="candidate-name">
              {% if demande.date_debut and demande.date_fin %}
                {{ demande.date_debut|date:"d/m/Y" }} - {{ demande.date_fin|date:"d/m/Y" }}
              {% else %}
                Dates non d√©finies
              {% endif %}
            </div>
            <div class="candidate-position">{{ demande.duree_mission|default:0 }} jour(s)</div>
          </div>
        </td>
        <td>
          {% if demande.statut == 'SOUMISE' %}
            <span class="status-badge status-soumise">{{ demande.get_statut_display }}</span>
          {% elif demande.statut == 'EN_VALIDATION' %}
            <span class="status-badge status-en-validation">{{ demande.get_statut_display }}</span>
          {% elif demande.statut == 'EN_COURS' %}
            <span class="status-badge status-en-cours">{{ demande.get_statut_display }}</span>
          {% elif demande.statut == 'TERMINEE' %}
            <span class="status-badge status-terminee">{{ demande.get_statut_display }}</span>
          {% else %}
            <span class="status-badge">{{ demande.get_statut_display }}</span>
          {% endif %}
        </td>
        <td>
          {% if demande.urgence == 'CRITIQUE' %}
            <span class="status-badge" style="background: var(--danger); color: white;">üö® Critique</span>
          {% elif demande.urgence == 'ELEVEE' %}
            <span class="status-badge" style="background: var(--orange); color: white;">‚ö†Ô∏è √âlev√©e</span>
          {% elif demande.urgence == 'MOYENNE' %}
            <span class="status-badge" style="background: var(--primary-light); color: var(--primary);">üìã Moyenne</span>
          {% else %}
            <span class="status-badge" style="background: var(--gray-200); color: var(--gray-700);">üìù Normale</span>
          {% endif %}
        </td>
        <td>
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <a href="{% url 'demande_detail' demande.id %}" class="btn btn-outline" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
              <i class="fas fa-eye"></i>
              Voir
            </a>
            {% if demande.statut == 'SOUMISE' %}
            <a href="#" class="btn btn-primary" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
              <i class="fas fa-user-plus"></i>
              Proposer
            </a>
            {% endif %}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <i class="fas fa-users-slash"></i>
    <p>Aucune demande r√©cente de votre √©quipe</p>
    <a href="{% url 'interim_demande' %}" class="btn btn-primary">
      <i class="fas fa-plus"></i>
      Cr√©er une demande
    </a>
  </div>
  {% endif %}
</div>

<!-- Matrice des membres d'√©quipe -->
<div class="team-matrix">
  <div class="matrix-header">
    <i class="fas fa-th-large"></i>
    Matrice des Membres d'√âquipe
  </div>
  <div class="matrix-grid">
    {% if equipe_directe %}
      {% for membre in equipe_directe %}
      <div class="member-matrix-card">
        <div class="member-matrix-header">
          <div style="display: flex; align-items: center;">
            <div class="member-avatar-large">{{ membre.initiales }}</div>
            <div>
              <div class="member-matrix-name">{{ membre.nom_complet }}</div>
              <div style="font-size: 0.9rem; color: var(--gray-600);">{{ membre.poste.titre|default:"Poste non d√©fini" }}</div>
            </div>
          </div>
          {% if membre.statut_employe == 'ACTIF' %}
            <div class="member-matrix-status"></div>
          {% elif membre.statut_employe == 'CONGE' %}
            <div class="member-matrix-status warning"></div>
          {% else %}
            <div class="member-matrix-status critical"></div>
          {% endif %}
        </div>
        <div class="member-matrix-metrics">
          <div class="member-matrix-metric">
            <div class="member-matrix-value">{{ membre.demandes_soumises.count }}</div>
            <div class="member-matrix-label">Demandes</div>
          </div>
          <div class="member-matrix-metric">
            <div class="member-matrix-value">{{ membre.selections_interim.count }}</div>
            <div class="member-matrix-label">Missions</div>
          </div>
          <div class="member-matrix-metric">
            <div class="member-matrix-value">{{ membre.taux_reussite|default:90 }}%</div>
            <div class="member-matrix-label">R√©ussite</div>
          </div>
          <div class="member-matrix-metric">
            <a href="{% url 'employe_detail' membre.matricule %}" class="btn btn-outline" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
              <i class="fas fa-eye"></i>
              Profil
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
    <div class="empty-state">
      <i class="fas fa-users-slash"></i>
      <p>Aucun membre d'√©quipe assign√©</p>
      <small>Les membres de votre √©quipe appara√Ætront ici une fois assign√©s</small>
    </div>
    {% endif %}
  </div>
</div>

<!-- Analytics √©quipe -->
<div class="team-analytics">
  <div class="analytics-header">
    <div>
      <i class="fas fa-chart-pie"></i>
      Analytics √âquipe
    </div>
    <button class="btn" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white;" onclick="generateTeamReport()">
      <i class="fas fa-file-export"></i>
      Rapport √âquipe
    </button>
  </div>
  <div class="analytics-content">
    <div class="analytics-grid">
      <div class="analytics-chart">
        <div class="chart-title">Performance √âquipe</div>
        <div class="chart-placeholder">
          Graphique: √âvolution performance mensuelle
        </div>
      </div>
      
      <div class="analytics-chart">
        <div class="chart-title">R√©partition des Missions</div>
        <div class="chart-placeholder">
          Graphique: Missions par membre d'√©quipe
        </div>
      </div>
      
      <div class="analytics-chart">
        <div class="chart-title">Charge de Travail</div>
        <div class="chart-placeholder">
          Graphique: Disponibilit√© vs demandes
        </div>
      </div>
      
      <div class="analytics-chart">
        <div class="chart-title">D√©lais de Validation</div>
        <div class="chart-placeholder">
          Graphique: Temps moyen de validation
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Actions de gestion d'√©quipe -->
<div class="section-header">
  <h3 class="section-title">
    <i class="fas fa-tools"></i>
    Actions de Gestion d'√âquipe
  </h3>
</div>

<div class="team-actions">
  <a href="{% url 'interim_demande' %}" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-plus-circle"></i>
    </div>
    <div class="team-action-title">Nouvelle Demande</div>
    <div class="team-action-desc">Cr√©er une demande d'int√©rim</div>
  </a>
  
  <a href="{% url 'employes_liste' %}" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-user-friends"></i>
    </div>
    <div class="team-action-title">Gestion √âquipe</div>
    <div class="team-action-desc">Profils et disponibilit√©s</div>
  </a>
  
  <a href="#" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-user-plus"></i>
    </div>
    <div class="team-action-title">Proposer Candidats</div>
    <div class="team-action-desc">Sugg√©rer des int√©rimaires</div>
  </a>
  
  <a href="{% url 'interim_stats' %}" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-chart-line"></i>
    </div>
    <div class="team-action-title">Statistiques</div>
    <div class="team-action-desc">Analytics et performance</div>
  </a>
  
  <a href="#" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-calendar-alt"></i>
    </div>
    <div class="team-action-title">Planning √âquipe</div>
    <div class="team-action-desc">Calendrier et planification</div>
  </a>
  
  <a href="#" class="team-action">
    <div class="team-action-icon">
      <i class="fas fa-bell"></i>
    </div>
    <div class="team-action-title">Notifications</div>
    <div class="team-action-desc">Alertes et rappels √©quipe</div>
  </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Configuration sp√©cifique chef d'√©quipe
const teamDashboardConfig = {
  teamSize: {{ stats.membres_equipe }},
  refreshInterval: 90000, // 1.5 minutes pour les chefs d'√©quipe
  autoRefresh: true,
  teamScope: 'TEAM_LEAD',
  criticalThresholds: {
    teamLoad: 80,
    pendingValidations: 10,
    unavailableMembers: 3
  }
};

// Fonctions de gestion d'√©quipe
function refreshTeamData() {
  const refreshBtn = document.querySelector('[onclick="refreshTeamData()"]');
  if (refreshBtn) {
    const icon = refreshBtn.querySelector('i');
    icon.classList.add('spinning');
  }
  
  fetch('{% url "refresh_stats_ajax" %}', {
    method: 'GET',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}',
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      showNotification('Donn√©es d\'√©quipe mises √† jour', 'success');
      setTimeout(() => location.reload(), 1000);
    } else {
      showNotification('Erreur lors de la mise √† jour', 'error');
    }
  })
  .catch(error => {
    console.error('Erreur:', error);
    showNotification('Erreur lors de la mise √† jour', 'error');
  })
  .finally(() => {
    if (refreshBtn) {
      const icon = refreshBtn.querySelector('i');
      icon.classList.remove('spinning');
    }
  });
}

function exportTeamData() {
  showNotification('Export des donn√©es d\'√©quipe en cours...', 'info');
  
  // Simulation d'export
  setTimeout(() => {
    showNotification('Export de l\'√©quipe termin√© avec succ√®s', 'success');
  }, 2000);
}

function generateTeamReport() {
  showNotification('G√©n√©ration du rapport d\'√©quipe en cours...', 'info');
  
  // Simulation de g√©n√©ration de rapport
  setTimeout(() => {
    showNotification('Rapport d\'√©quipe g√©n√©r√© avec succ√®s', 'success');
  }, 2500);
}

// Surveillance sp√©cifique √©quipe
function monitorTeamHealth() {
  const teamSize = {{ stats.membres_equipe }};
  const pendingValidations = {{ stats.validations_a_traiter }};
  const activeMissions = {{ stats.missions_en_cours }};
  
  // Alerte si √©quipe r√©duite
  if (teamSize < 3) {
    showNotification(
      `‚ö†Ô∏è √âquipe r√©duite: seulement ${teamSize} membre(s) - Planification recommand√©e`, 
      'warning'
    );
  }
  
  // Alerte charge de travail
  if (activeMissions > teamSize * 2) {
    showNotification(
      `üìä Charge √©lev√©e: ${activeMissions} missions pour ${teamSize} membre(s)`, 
      'info'
    );
  }
  
  // Rappel validations
  if (pendingValidations > 0) {
    setTimeout(() => {
      showNotification(
        `üìã Rappel: ${pendingValidations} validation(s) en attente pour votre √©quipe`, 
        'info',
        {
          url: '{% url "liste_interim_validation" %}',
          text: 'Suivre le statut'
        }
      );
    }, 3000);
  }
}

// Animation des statistiques √©quipe
function animateTeamStats() {
  const teamStats = document.querySelectorAll('.team-stat-value');
  
  teamStats.forEach((stat, index) => {
    const text = stat.textContent;
    const value = parseFloat(text);
    
    if (!isNaN(value)) {
      let current = 0;
      const increment = value / 50; // Animation plus rapide pour √©quipe
      const suffix = text.replace(value.toString(), '');
      
      setTimeout(() => {
        const timer = setInterval(() => {
          current += increment;
          if (current >= value) {
            current = value;
            clearInterval(timer);
          }
          
          if (value >= 100) {
            stat.textContent = Math.floor(current) + suffix;
          } else {
            stat.textContent = Math.floor(current) + suffix;
          }
        }, 25);
      }, index * 150);
    }
  });
}

// Monitoring temps r√©el √©quipe
function startTeamMonitoring() {
  if (!teamDashboardConfig.autoRefresh) return;
  
  setInterval(() => {
    // V√©rifications silencieuses pour l'√©quipe
    fetch('{% url "refresh_stats_ajax" %}', {
      method: 'GET',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        updateTeamIndicators(data);
      }
    })
    .catch(error => {
      console.warn('Surveillance √©quipe: ', error);
    });
  }, teamDashboardConfig.refreshInterval);
}

function updateTeamIndicators(data) {
  // Mise √† jour subtile des indicateurs √©quipe
  if (data.stats) {
    const healthCards = document.querySelectorAll('.health-value');
    healthCards.forEach(card => {
      card.style.transform = 'scale(1.02)';
      setTimeout(() => {
        card.style.transform = 'scale(1)';
      }, 150);
    });
  }
}

// Raccourcis clavier pour chef d'√©quipe
function setupTeamKeyboardShortcuts() {
  document.addEventListener('keydown', function(e) {
    // Ctrl+T = Refresh √©quipe
    if (e.ctrlKey && e.key === 't') {
      e.preventDefault();
      refreshTeamData();
    }
    
    // Ctrl+N = Nouvelle demande
    if (e.ctrlKey && e.key === 'n') {
      e.preventDefault();
      window.location.href = '{% url "interim_demande" %}';
    }
    
    // Ctrl+E = Export √©quipe
    if (e.ctrlKey && e.key === 'e') {
      e.preventDefault();
      exportTeamData();
    }
    
    // Ctrl+G = Gestion √©quipe
    if (e.ctrlKey && e.key === 'g') {
      e.preventDefault();
      window.location.href = '{% url "employes_liste" %}';
    }
  });
}

// Gestion des notifications √©quipe
function setupTeamNotifications() {
  // Alerte si membre critique indisponible
  {% if stats.membres_critiques_indisponibles > 0 %}
  setTimeout(() => {
    showNotification(
      'üö® Attention: {{ stats.membres_critiques_indisponibles }} membre(s) critique(s) indisponible(s)', 
      'warning',
      {
        url: '{% url "employes_liste" %}',
        text: 'Voir l\'√©quipe'
      }
    );
  }, 4000);
  {% endif %}
  
  // Message de motivation √©quipe
  const teamPerformance = {{ stats.taux_reussite_equipe|default:85 }};
  if (teamPerformance >= 90) {
    setTimeout(() => {
      showNotification(
        `üèÜ Excellente performance d'√©quipe: ${teamPerformance}% de r√©ussite!`, 
        'success'
      );
    }, 6000);
  }
}

// Initialisation compl√®te chef d'√©quipe
document.addEventListener('DOMContentLoaded', function() {
  // Surveillance √©quipe
  setTimeout(monitorTeamHealth, 1500);
  
  // Animations
  setTimeout(animateTeamStats, 800);
  
  // Monitoring temps r√©el
  startTeamMonitoring();
  
  // Raccourcis clavier
  setupTeamKeyboardShortcuts();
  
  // Notifications √©quipe
  setupTeamNotifications();
  
  // Message de bienvenue chef d'√©quipe
  setTimeout(() => {
    showNotification(
      `üë• Mode Chef d'√âquipe activ√© - Supervision de ${teamDashboardConfig.teamSize} collaborateur(s)`, 
      'success'
    );
  }, 2000);
  
  // Rappel des raccourcis
  setTimeout(() => {
    console.log(`
üë• RACCOURCIS CHEF D'√âQUIPE:
‚Ä¢ Ctrl+T : Refresh √©quipe
‚Ä¢ Ctrl+N : Nouvelle demande
‚Ä¢ Ctrl+E : Export √©quipe
‚Ä¢ Ctrl+G : Gestion √©quipe
    `);
  }, 1000);
});

// Fonctions avanc√©es chef d'√©quipe
function quickTeamAssign() {
  showNotification('Assignation rapide d\'√©quipe...', 'info');
  // Logique d'assignation rapide
}

function teamEmergencyAlert() {
  const alertMessage = prompt('Message d\'alerte √©quipe:');
  if (alertMessage) {
    showNotification('üö® ALERTE √âQUIPE: ' + alertMessage, 'warning');
  }
}

function generateTeamPlan() {
  showNotification('G√©n√©ration du planning √©quipe...', 'info');
  
  setTimeout(() => {
    showNotification('Planning √©quipe g√©n√©r√© avec succ√®s', 'success');
  }, 2000);
}

console.log('Dashboard chef d\'√©quipe initialis√©:', teamDashboardConfig);
console.log('üë• Mode Chef d\'√âquipe actif - Gestion compl√®te de l\'√©quipe');
</script>
{% endblock %}